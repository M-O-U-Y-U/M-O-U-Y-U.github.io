<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„å…¨æ¯æ—…è¡Œåœ°å›¾</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; }
        #map { height: 100vh; width: 100%; }
        
        /* å®šä½æŒ‰é’®çš„æ ·å¼ */
        .locate-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="map"></div>
    
    <button class="locate-btn" onclick="locateUser()">ğŸ“ å›åˆ°æˆ‘çš„ä½ç½®</button>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // 1. åˆå§‹åŒ–åœ°å›¾
        // é»˜è®¤å…ˆçœ‹ä¸­å›½å…¨è²Œï¼Œå¦‚æœå®šä½æˆåŠŸä¼šè‡ªåŠ¨è·³è½¬
        var map = L.map('map').setView([35.8617, 104.1954], 4);

        // 2. æ›´æ¢åº•å›¾ï¼šä½¿ç”¨ Esri World Imagery (é«˜æ¸…å«æ˜Ÿå½±åƒ)
        // è¿™å¯¹äºé¥æ„Ÿä¸“ä¸šçš„ä½ æ¥è¯´åº”è¯¥å¾ˆäº²åˆ‡
        var satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
            maxZoom: 19
        });
        
        // å¦‚æœè§‰å¾—å«æ˜Ÿå›¾å¤ªèŠ±ï¼Œæƒ³çœ‹è·¯ç½‘ï¼Œå¯ä»¥æŠŠä¸‹é¢è¿™è¡Œå–æ¶ˆæ³¨é‡Šï¼ŒæŠŠä¸Šé¢é‚£è¡Œæ³¨é‡Šæ‰
        // var streetLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 });

        satelliteLayer.addTo(map);

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šè·å–çœŸå®ä½ç½® ---
        
        function locateUser() {
            // map.locate æ˜¯ Leaflet è‡ªå¸¦çš„å®šä½åŠŸèƒ½
            // setView: true è¡¨ç¤ºæ‰¾åˆ°ä½ç½®åè‡ªåŠ¨æŠŠåœ°å›¾ä¸­å¿ƒç§»è¿‡å»
            // maxZoom: 16 è¡¨ç¤ºæ‰¾åˆ°åç¼©æ”¾åˆ°è¡—é“çº§åˆ«
            map.locate({setView: true, maxZoom: 16});
        }

        // ç›‘å¬ï¼šå¦‚æœæ‰¾åˆ°ä½ç½®äº†ï¼Œè¦åšä»€ä¹ˆï¼Ÿ
        function onLocationFound(e) {
            var radius = e.accuracy / 2; // è·å–å®šä½ç²¾åº¦èŒƒå›´

            // åœ¨å½“å‰ä½ç½®ç”»ä¸€ä¸ªè“è‰²çš„åœ†ç‚¹
            L.circleMarker(e.latlng, {
                radius: 8,
                fillColor: "#3388ff",
                color: "#fff",
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map)
            .bindPopup("ä½ ç°åœ¨å°±åœ¨è¿™é‡Œï¼<br>ç²¾åº¦èŒƒå›´: " + radius + "ç±³").openPopup();

            // ç”»ä¸€ä¸ªåŠé€æ˜çš„å¤§åœ†åœˆè¡¨ç¤ºç²¾åº¦èŒƒå›´
            L.circle(e.latlng, radius).addTo(map);
        }

        // ç›‘å¬ï¼šå¦‚æœå®šä½å¤±è´¥äº†ï¼ˆæ¯”å¦‚ç”¨æˆ·æ‹’ç»æƒé™ï¼‰ï¼Œè¦åšä»€ä¹ˆï¼Ÿ
        function onLocationError(e) {
            alert("æ— æ³•è·å–æ‚¨çš„ä½ç½®ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™ã€‚\né”™è¯¯ä¿¡æ¯: " + e.message);
        }

        map.on('locationfound', onLocationFound);
        map.on('locationerror', onLocationError);

        // 3. é¡µé¢ä¸€åŠ è½½ï¼Œè‡ªåŠ¨å¼€å§‹å®šä½
        locateUser();

        // --- ä¹‹å‰çš„æ”»ç•¥æ•°æ®ä¿ç•™ ---
        var marker1 = L.marker([39.9042, 116.4074]).addTo(map);
        marker1.bindPopup("<b>ğŸ‡¨ğŸ‡³ åŒ—äº¬Â·å¤©å®‰é—¨</b><br>é¥æ„Ÿåæ ‡: 39.90, 116.40");

    </script>
</body>
</html>
